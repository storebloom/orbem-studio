document.addEventListener("DOMContentLoaded",(function(){const e=document.querySelectorAll(".map-item"),t=document.querySelectorAll('[data-trigger="true"], [data-genre="explore-area"], .map-cutscene'),n=document.querySelectorAll(".find-explore-item"),o=document.getElementById("map-character"),s=document.querySelectorAll("#add-new-list li"),d=document.getElementById("god-mode"),a=document.getElementById("no-touch");if(window.godMode=!1,window.noTouch=!1,d&&a&&(d.addEventListener("change",(()=>{d.checked?window.godMode=!0:window.godMode=!1})),a.addEventListener("change",(()=>{a.checked?window.noTouch=!0:window.noTouch=!1}))),s&&s.forEach((function(e){e.addEventListener("click",(()=>{const t=e.dataset.type;e.classList.add("engage");const n=`https://${wpThemeURL}/wp-json/orbemorder/v1/get-new-fields/`,o={type:t};fetch(n,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)}).then((e=>{if(!e.ok)throw new Error("Network response was not ok "+e.statusText);return e.json()})).then((e=>{const t=document.querySelector(".add-new-fields");t&&(t.innerHTML=e.data,"function"==typeof initImageUpload&&(initImageUpload(),function(){const e=document.getElementById("add-new-form");e&&e.addEventListener("submit",(function(t){var n;t.preventDefault();const o=function(e){const t=Object.fromEntries(e.entries()),n={};for(const[e,o]of Object.entries(t)){const t=e.replace(/\]/g,"").split("[");let s=n;for(;t.length>1;){const e=t.shift();e in s||(s[e]={}),s=s[e]}s[t[0]]=o}return n}(new FormData(e)),s=`https://${wpThemeURL}/wp-json/orbemorder/v1/add-new/`,d=document.querySelector("#add-new-list li.engage");let a="";d&&(a=d.dataset.type);const r={type:a,area:null!==(n=currentLocation)&&void 0!==n?n:"",values:o};fetch(s,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)}).then((e=>{if(!e.ok)throw new Error("Network response was not ok "+e.statusText);window.location.reload()}))}))}()))}))}))})),n&&n.length>0&&n.forEach((e=>{const t=e.querySelector(".find-title"),n=e.querySelector(".edit-item-button"),s=e.querySelector(".close-item-button");if(n){const t=n.closest(".find-explore-item").id.replace("-f",""),o=document.getElementById(t);n.addEventListener("click",(d=>{if(!0!==n.classList.contains("created")){const d=document.createElement("div"),a=document.createElement("label"),r=document.createElement("input"),l=document.createElement("label"),i=document.createElement("input"),c=document.createElement("button");let p=o.style.height;p=p?p.replace("px",""):"";let m=o.style.width;m=m?m.replace("px",""):"",s.style.display="block",a.textContent="Height",l.textContent="Width",d.classList.add("size-input"),r.type="number",r.value=p&&""!==p?p:o.dataset?.height,i.type="number",i.value=m&&""!==m?m:o.dataset?.width,c.classList.add("submit-size"),c.textContent="submit",a.appendChild(r),l.appendChild(i),d.appendChild(a),d.appendChild(l),d.appendChild(c),e.appendChild(d),n.classList.add("created"),c.addEventListener("click",(a=>{const l=`https://${wpThemeURL}/wp-json/orbemorder/v1/set-item-size/`,c={height:r.value,width:i.value,id:t,meta:e.dataset?.meta};fetch(l,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(c)}).then((e=>{if(!e.ok)throw new Error("Network response was not ok "+e.statusText);d.remove(),n.classList.remove("created"),s.style.display="none",o&&(o.style.height=`${r.value}px`,o.style.width=`${i.value}px`)}))})),s.addEventListener("click",(e=>{d.remove(),n.classList.remove("created"),s.style.display="none"}))}}))}t.addEventListener("click",(t=>{const n=document.querySelector("."+t.target.closest(".find-explore-item").dataset.class),s=document.querySelector(".map-item.selected"),d=document.querySelector(".find-explore-item.selected");s&&s.classList.remove("selected"),d&&d.classList.remove("selected"),n&&(o.style.left=parseInt(n.style.left.replace("px",""))-200+"px",o.style.top=parseInt(n.style.top.replace("px",""))-200+"px",n.scrollIntoView(),n.classList.add("selected"),e.classList.add("selected"))}))})),e&&e.length){let c,p=null,m=0,u=0;function r(e){if(clearTimeout(c),e.preventDefault(),p=e.target.closest(".map-item"),p){const t=p.getBoundingClientRect();m=e.clientX-t.left,u=e.clientY-t.top,e.dataTransfer.setData("text/plain",""),document.addEventListener("mousemove",l)}}function l(e){if(p){const t=document.querySelector(".container").getBoundingClientRect(),n=e.clientX-t.left,o=e.clientY-t.top;p.style.left=n-m+"px",p.style.top=o-u+"px"}}function i(){p&&(c=setTimeout((()=>{const e=`https://${wpThemeURL}/wp-json/orbemorder/v1/set-item-position/`,t="true"===p.dataset.trigger?p.id.replace("-t",""):p.id,n={top:p.style.top.replace("px",""),left:p.style.left.replace("px",""),height:p.style.height.replace("px",""),width:p.style.width.replace("px",""),id:t,meta:p.dataset?.meta};fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)}).then((e=>{if(!e.ok)throw new Error("Network response was not ok "+e.statusText)})),p=null}),1e3),document.removeEventListener("mousemove",l))}e.forEach((e=>{e.draggable=!0,e.addEventListener("dragstart",r),e.addEventListener("mouseup",i)}))}t&&t.forEach((e=>{e.style.backgroundColor="rgba(0,146,255,0.31)"}))}));